## 3. Compliance Agent Documentation

# HSA Compliance Agent Documentation

## Overview
The Compliance Agent performs comprehensive final compliance checks on all HSA transactions. It ensures that contributions, distributions, and account management comply with IRS rules, regulations, and reporting requirements.

## Agent Responsibilities

### Primary Functions
- **Final Compliance Verification**: Comprehensive review of all transaction components
- **Violation Detection**: Identifies IRS rule violations that could result in penalties
- **Warning Generation**: Flags potential compliance issues requiring attention
- **Documentation Compliance**: Ensures proper record-keeping requirements are met
- **Reporting Requirement Verification**: Confirms all IRS reporting obligations are addressed

### State Management
The agent processes and updates the following state fields:
- `compliance_check_result`: Overall compliance status ("COMPLIANT", "WARNING", "VIOLATION")
- `compliance_violations`: List of IRS rule violations
- `compliance_warnings`: List of compliance warnings and recommendations
- `workflow_status`: Final workflow completion status
- `messages`: List of messages generated by the Compliance Agent, including success, warning, and error messages

## Compliance Framework

### Compliance Status Hierarchy
1. **COMPLIANT**: All IRS rules satisfied, no violations or warnings
2. **WARNING**: Compliant but with recommendations for optimization
3. **VIOLATION**: IRS rule violations detected, transaction should be rejected

### Compliance Check Categories

#### 1. Eligibility Compliance
```python
def _detect_critical_violations(self, state: HSAState) -> List[str]:
    violations = []
    
    # Eligibility violations
    if not state.get("is_eligible", False):
        violations.append("HSA eligibility not met")
    
    # Contribution violations
    contribution_errors = state.get("contribution_errors", [])
    if contribution_errors:
        violations.extend(contribution_errors)
    
    # Distribution violations
    if not state.get("distribution_valid", True):
        violations.append("Invalid distribution request")
    
    return violations

def _detect_warning_conditions(self, state: HSAState) -> List[str]:
    warnings = []
    
    # Tax efficiency warnings
    if not user_data.get("payroll_deduction", False):
        warnings.append("Consider payroll deduction for tax efficiency")
    
    # Contribution optimization
    if contribution_amount < contribution_limit * 0.5:
        warnings.append("Consider maximizing HSA contributions")
    
    # Documentation warnings
    if not user_data.get("has_receipts", False):
        warnings.append("Maintain receipts for medical expenses")
    
    return warnings
```

#### Example State Update
```json
{
    "compliance_check_result": "COMPLIANT",
    "compliance_violations": null,
    "compliance_warnings": null,
    "workflow_status": "completed",
    "messages": [
        {
            "agent": "ComplianceAgent",
            "message": "All compliance checks passed. Transaction is compliant with IRS rules.",
            "type": "success"
        }
    ]
}
```